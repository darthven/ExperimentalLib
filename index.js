"use strict";function createCommonjsModule(e,t){return t={exports:{}},e(t,t.exports),t.exports}function __extends(e,t){function n(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function component(e){return function(t,n){var o=t[n],r=function(){var n=o.call(t),r=Object.getPrototypeOf(n);Object.keys(n).forEach(function(e){n[e]&&n[e].hasOwnProperty("component")&&(n[e]=n[e].component.getEntityInstance())});var i=e.id||generateComponentId(),a=new Component(i,e.name,e.classPath,e.scope),c=getComponentLifecycle(r,i);return a.setEntityInstance(n),{component:a,lifecycle:c}};return Object.defineProperty(t,n,{value:r}),Object.getOwnPropertyDescriptor(t,n)}}function preInit(e,t){return Object.defineProperty(e,t,{value:{preInitMethod:e[t]}}),Object.getOwnPropertyDescriptor(e,t)}function postInit(e,t){return Object.defineProperty(e,t,{value:{postInitMethod:e[t]}}),Object.getOwnPropertyDescriptor(e,t)}function preDestroy(e,t){return Object.defineProperty(e,t,{value:{preDestroyMethod:e[t]}}),Object.getOwnPropertyDescriptor(e,t)}function postDestroy(e,t){return Object.defineProperty(e,t,{value:{postDestroyMethod:e[t]}}),Object.getOwnPropertyDescriptor(e,t)}Object.defineProperty(exports,"__esModule",{value:!0});var commonjsGlobal="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},isBuffer=function(e){return e instanceof Buffer},util$2=createCommonjsModule(function(e,t){function n(e,n){var i={seen:[],stylize:r};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),d(n)?i.showHidden=n:n&&t._extend(i,n),C(i.showHidden)&&(i.showHidden=!1),C(i.depth)&&(i.depth=2),C(i.colors)&&(i.colors=!1),C(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=o),a(i,e,i.depth)}function o(e,t){var o=n.styles[t];return o?"["+n.colors[o][0]+"m"+e+"["+n.colors[o][1]+"m":e}function r(e,t){return e}function i(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function a(e,n,o){if(e.customInspect&&n&&w(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var r=n.inspect(o,e);return g(r)||(r=a(e,r,o)),r}var d=c(e,n);if(d)return d;var h=Object.keys(n),y=i(h);if(e.showHidden&&(h=Object.getOwnPropertyNames(n)),P(n)&&(h.indexOf("message")>=0||h.indexOf("description")>=0))return s(n);if(0===h.length){if(w(n)){var m=n.name?": "+n.name:"";return e.stylize("[Function"+m+"]","special")}if(O(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(b(n))return e.stylize(Date.prototype.toString.call(n),"date");if(P(n))return s(n)}var v="",C=!1,E=["{","}"];if(p(n)&&(C=!0,E=["[","]"]),w(n)&&(v=" [Function"+(n.name?": "+n.name:"")+"]"),O(n)&&(v=" "+RegExp.prototype.toString.call(n)),b(n)&&(v=" "+Date.prototype.toUTCString.call(n)),P(n)&&(v=" "+s(n)),0===h.length&&(!C||0==n.length))return E[0]+v+E[1];if(o<0)return O(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special");e.seen.push(n);var M;return M=C?l(e,n,o,y,h):h.map(function(t){return f(e,n,o,y,t,C)}),e.seen.pop(),u(M,v,E)}function c(e,t){if(C(t))return e.stylize("undefined","undefined");if(g(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return m(t)?e.stylize(""+t,"number"):d(t)?e.stylize(""+t,"boolean"):h(t)?e.stylize("null","null"):void 0}function s(e){return"["+Error.prototype.toString.call(e)+"]"}function l(e,t,n,o,r){for(var i=[],a=0,c=t.length;a<c;++a)L(t,String(a))?i.push(f(e,t,n,o,String(a),!0)):i.push("");return r.forEach(function(r){r.match(/^\d+$/)||i.push(f(e,t,n,o,r,!0))}),i}function f(e,t,n,o,r,i){var c,s,l;if(l=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]},l.get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),L(o,r)||(c="["+r+"]"),s||(e.seen.indexOf(l.value)<0?(s=h(n)?a(e,l.value,null):a(e,l.value,n-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),C(c)){if(i&&r.match(/^\d+$/))return s;(c=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(c=c.substr(1,c.length-2),c=e.stylize(c,"name")):(c=c.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),c=e.stylize(c,"string"))}return c+": "+s}function u(e,t,n){var o=0;return e.reduce(function(e,t){return o++,t.indexOf("\n")>=0&&o++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function p(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function h(e){return null===e}function y(e){return null==e}function m(e){return"number"==typeof e}function g(e){return"string"==typeof e}function v(e){return"symbol"==typeof e}function C(e){return void 0===e}function O(e){return E(e)&&"[object RegExp]"===x(e)}function E(e){return"object"==typeof e&&null!==e}function b(e){return E(e)&&"[object Date]"===x(e)}function P(e){return E(e)&&("[object Error]"===x(e)||e instanceof Error)}function w(e){return"function"==typeof e}function M(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function x(e){return Object.prototype.toString.call(e)}function L(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.format=function(e){if(!g(e)){for(var t=[],o=0;o<arguments.length;o++)t.push(n(arguments[o]));return t.join(" ")}for(var o=1,r=arguments,i=r.length,a=String(e).replace(/%[sdj%]/g,function(e){if("%%"===e)return"%";if(o>=i)return e;switch(e){case"%s":return String(r[o++]);case"%d":return Number(r[o++]);case"%j":try{return JSON.stringify(r[o++])}catch(e){return"[Circular]"}default:return e}}),c=r[o];o<i;c=r[++o])h(c)||!E(c)?a+=" "+c:a+=" "+n(c);return a},t.deprecate=function(e,n){function o(){if(!r){if(process.throwDeprecation)throw new Error(n);process.traceDeprecation,r=!0}return e.apply(this,arguments)}if(C(commonjsGlobal.process))return function(){return t.deprecate(e,n).apply(this,arguments)};if(!0===process.noDeprecation)return e;var r=!1;return o};var I,j={};t.debuglog=function(e){if(C(I)&&(I=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!j[e])if(new RegExp("\\b"+e+"\\b","i").test(I)){process.pid;j[e]=function(){t.format.apply(t,arguments)}}else j[e]=function(){};return j[e]},t.inspect=n,n.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},n.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=p,t.isBoolean=d,t.isNull=h,t.isNullOrUndefined=y,t.isNumber=m,t.isString=g,t.isSymbol=v,t.isUndefined=C,t.isRegExp=O,t.isObject=E,t.isDate=b,t.isError=P,t.isFunction=w,t.isPrimitive=M,t.isBuffer=isBuffer;t.log=function(){},t.inherits=inherits,t._extend=function(e,t){if(!t||!E(t))return e;for(var n=Object.keys(t),o=n.length;o--;)e[n[o]]=t[n[o]];return e}}),inherits=util$2.inherits,util=createCommonjsModule(function(e,t){function n(e,n){var i={seen:[],stylize:r};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),d(n)?i.showHidden=n:n&&t._extend(i,n),C(i.showHidden)&&(i.showHidden=!1),C(i.depth)&&(i.depth=2),C(i.colors)&&(i.colors=!1),C(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=o),a(i,e,i.depth)}function o(e,t){var o=n.styles[t];return o?"["+n.colors[o][0]+"m"+e+"["+n.colors[o][1]+"m":e}function r(e,t){return e}function i(e){var t={};return e.forEach(function(e,n){t[e]=!0}),t}function a(e,n,o){if(e.customInspect&&n&&w(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var r=n.inspect(o,e);return g(r)||(r=a(e,r,o)),r}var d=c(e,n);if(d)return d;var h=Object.keys(n),y=i(h);if(e.showHidden&&(h=Object.getOwnPropertyNames(n)),P(n)&&(h.indexOf("message")>=0||h.indexOf("description")>=0))return s(n);if(0===h.length){if(w(n)){var m=n.name?": "+n.name:"";return e.stylize("[Function"+m+"]","special")}if(O(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(b(n))return e.stylize(Date.prototype.toString.call(n),"date");if(P(n))return s(n)}var v="",C=!1,E=["{","}"];if(p(n)&&(C=!0,E=["[","]"]),w(n)&&(v=" [Function"+(n.name?": "+n.name:"")+"]"),O(n)&&(v=" "+RegExp.prototype.toString.call(n)),b(n)&&(v=" "+Date.prototype.toUTCString.call(n)),P(n)&&(v=" "+s(n)),0===h.length&&(!C||0==n.length))return E[0]+v+E[1];if(o<0)return O(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special");e.seen.push(n);var M;return M=C?l(e,n,o,y,h):h.map(function(t){return f(e,n,o,y,t,C)}),e.seen.pop(),u(M,v,E)}function c(e,t){if(C(t))return e.stylize("undefined","undefined");if(g(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return m(t)?e.stylize(""+t,"number"):d(t)?e.stylize(""+t,"boolean"):h(t)?e.stylize("null","null"):void 0}function s(e){return"["+Error.prototype.toString.call(e)+"]"}function l(e,t,n,o,r){for(var i=[],a=0,c=t.length;a<c;++a)L(t,String(a))?i.push(f(e,t,n,o,String(a),!0)):i.push("");return r.forEach(function(r){r.match(/^\d+$/)||i.push(f(e,t,n,o,r,!0))}),i}function f(e,t,n,o,r,i){var c,s,l;if(l=Object.getOwnPropertyDescriptor(t,r)||{value:t[r]},l.get?s=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(s=e.stylize("[Setter]","special")),L(o,r)||(c="["+r+"]"),s||(e.seen.indexOf(l.value)<0?(s=h(n)?a(e,l.value,null):a(e,l.value,n-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+s.split("\n").map(function(e){return"   "+e}).join("\n")):s=e.stylize("[Circular]","special")),C(c)){if(i&&r.match(/^\d+$/))return s;(c=JSON.stringify(""+r)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(c=c.substr(1,c.length-2),c=e.stylize(c,"name")):(c=c.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),c=e.stylize(c,"string"))}return c+": "+s}function u(e,t,n){var o=0;return e.reduce(function(e,t){return o++,t.indexOf("\n")>=0&&o++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}function p(e){return Array.isArray(e)}function d(e){return"boolean"==typeof e}function h(e){return null===e}function y(e){return null==e}function m(e){return"number"==typeof e}function g(e){return"string"==typeof e}function v(e){return"symbol"==typeof e}function C(e){return void 0===e}function O(e){return E(e)&&"[object RegExp]"===x(e)}function E(e){return"object"==typeof e&&null!==e}function b(e){return E(e)&&"[object Date]"===x(e)}function P(e){return E(e)&&("[object Error]"===x(e)||e instanceof Error)}function w(e){return"function"==typeof e}function M(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function x(e){return Object.prototype.toString.call(e)}function L(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.format=function(e){if(!g(e)){for(var t=[],o=0;o<arguments.length;o++)t.push(n(arguments[o]));return t.join(" ")}for(var o=1,r=arguments,i=r.length,a=String(e).replace(/%[sdj%]/g,function(e){if("%%"===e)return"%";if(o>=i)return e;switch(e){case"%s":return String(r[o++]);case"%d":return Number(r[o++]);case"%j":try{return JSON.stringify(r[o++])}catch(e){return"[Circular]"}default:return e}}),c=r[o];o<i;c=r[++o])h(c)||!E(c)?a+=" "+c:a+=" "+n(c);return a},t.deprecate=function(e,n){function o(){if(!r){if(process.throwDeprecation)throw new Error(n);process.traceDeprecation,r=!0}return e.apply(this,arguments)}if(C(commonjsGlobal.process))return function(){return t.deprecate(e,n).apply(this,arguments)};if(!0===process.noDeprecation)return e;var r=!1;return o};var I,j={};t.debuglog=function(e){if(C(I)&&(I=process.env.NODE_DEBUG||""),e=e.toUpperCase(),!j[e])if(new RegExp("\\b"+e+"\\b","i").test(I)){process.pid;j[e]=function(){t.format.apply(t,arguments)}}else j[e]=function(){};return j[e]},t.inspect=n,n.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},n.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=p,t.isBoolean=d,t.isNull=h,t.isNullOrUndefined=y,t.isNumber=m,t.isString=g,t.isSymbol=v,t.isUndefined=C,t.isRegExp=O,t.isObject=E,t.isDate=b,t.isError=P,t.isFunction=w,t.isPrimitive=M,t.isBuffer=isBuffer;t.log=function(){},t.inherits=inherits,t._extend=function(e,t){if(!t||!E(t))return e;for(var n=Object.keys(t),o=n.length;o--;)e[n[o]]=t[n[o]];return e}}),util_5=util.isArray,util_7=util.isNull,util_8=util.isNullOrUndefined,util_10=util.isString,util_12=util.isUndefined,util_14=util.isObject,util_17=util.isFunction,log4js=require("log4js"),LOGGER=log4js.getLogger(),ComponentLifecycle=function(){function e(e){this.componentId=e,this.setDefaultLifecycleMethods()}return e.prototype.setDefaultLifecycleMethods=function(){var e=this;this.preInitMethod=function(){return LOGGER.info('[Component Lifecycle]: Default pre-init-method is called to the component with id "'+e.componentId+'"')},this.postInitMethod=function(){return LOGGER.info('[Component Lifecycle]: Default post-init-method is called to the component with id "'+e.componentId+'"')},this.beforePropertiesWillBeSetMethod=function(){return LOGGER.info('[Component Lifecycle]: Default before-properties-will-be-set-method is called to the component with id "'+e.componentId+'"')},this.afterPropertiesWereSetMethod=function(){return LOGGER.info('[Component Lifecycle]: Default after-properties-were-set-method is called to the component with id "'+e.componentId+'"')},this.preDestroyMethod=function(){return LOGGER.info('[Component Lifecycle]: Default pre-destroy-method is called to the component with id "'+e.componentId+'"')},this.postDestroyMethod=function(){return LOGGER.info('[Component Lifecycle]: Default post-destroy-method is called to the component with id "'+e.componentId+'"')}},e.prototype.getComponentId=function(){return this.componentId},e.prototype.setComponentId=function(e){this.componentId=e},e.prototype.callPreInitMethod=function(){LOGGER.debug('[Component Lifecycle]: Before Component with id "'+this.getComponentId()+'" will be initialized'),this.preInitMethod()},e.prototype.setPreInitMethod=function(e){this.preInitMethod=e},e.prototype.callPostInitMethod=function(){LOGGER.debug('[Component Lifecycle]: After Component with id "'+this.getComponentId()+'" was initialized'),this.postInitMethod()},e.prototype.setPostInitMethod=function(e){this.postInitMethod=e},e.prototype.callBeforePropertiesWillBeSetMethod=function(){LOGGER.debug('[Component Lifecycle]: Before Component with id "'+this.getComponentId()+'" will receive its properties'),this.beforePropertiesWillBeSetMethod()},e.prototype.setBeforePropertiesWillBeSetMethod=function(e){this.beforePropertiesWillBeSetMethod=e},e.prototype.callAfterPropertiesWereSetMethod=function(){LOGGER.debug('[Component Lifecycle]: After Component with id "'+this.getComponentId()+'" received its properties'),this.afterPropertiesWereSetMethod()},e.prototype.setAfterPropertiesWereSetMethod=function(e){this.afterPropertiesWereSetMethod=e},e.prototype.callPreDestroyMethod=function(){LOGGER.debug('[Component Lifecycle]: Before Component with id "'+this.getComponentId()+'" will be destroyed'),this.preDestroyMethod()},e.prototype.setPreDestroyMethod=function(e){this.preDestroyMethod=e},e.prototype.callPostDestroyMethod=function(){LOGGER.debug('[Component Lifecycle]: After Component with id "'+this.getComponentId()+'" was destroyed'),this.postDestroyMethod()},e.prototype.setPostDestroyMethod=function(e){this.postDestroyMethod=e},e.prototype.setLifecycleMethods=function(e){var t=this;Object.keys(e).forEach(function(n){t[n]&&!util_7(e[n])&&(t[n]=e[n])})},e}(),extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},LifecycleNotFoundError=function(e){function t(t){var n=e.call(this,'Lifecycle of the Component with id "'+t+'" cannot be found in context')||this;return n.name="LifecycleNotFoundError",n}return __extends(t,e),t}(Error),ContextLifecycle=function(){function e(){this.componentLifecycles=new Map}return e.prototype.getComponentLifecycles=function(){return this.componentLifecycles},e.prototype.getLifecycleByComponentId=function(e){var t=this.componentLifecycles.get(e);if(!t)throw new LifecycleNotFoundError(e);return t},e}(),Component=function(){function e(e,t,n,o){this.id=e||null,this.componentName=t||null,this.classPath=n||null,this.scope=o||0}return e.prototype.getId=function(){return this.id},e.prototype.getComponentName=function(){return this.componentName},e.prototype.getClassPath=function(){return this.classPath},e.prototype.getScope=function(){return this.scope},e.prototype.getEntityInstance=function(){return this.entityInstance},e.prototype.setEntityInstance=function(e){this.entityInstance=e},e}(),ComponentNotFoundError=function(e){function t(t){var n=e.call(this,'Component with id "'+t+'" cannot be found in context')||this;return n.name="ComponentNotFoundError",n}return __extends(t,e),t}(Error),_$1=require("lodash"),Context=function(){function e(){this.contextLifecycle=new ContextLifecycle,this.components=new Map}return e.prototype.getContextLifecycle=function(){return this.contextLifecycle},e.prototype.getComponents=function(){return this.components},e.prototype.removeComponentFromContext=function(e){return this.components.delete(e)},e.prototype.close=function(){var e=this;LOGGER.info("[Context]: Closing current context..."),this.components.forEach(function(t){var n=e.contextLifecycle.getComponentLifecycles().get(t.getId());n.callPreDestroyMethod(),e.removeComponentFromContext(t.getId()),n.callPostDestroyMethod()}),LOGGER.info("[Context]: Context is closed..."),this.components.clear()},e.prototype.registerShutdownHook=function(){var e=this;process.on("exit",function(){e.close()}),process.on("SIGINT",function(){e.close()})},e.prototype.getComponentEntityInstanceById=function(e){var t=this.components.get(e);if(!t)throw new ComponentNotFoundError(e);return 1===t.getScope()?_$1.cloneDeep(t.getEntityInstance()):t.getEntityInstance()},e.prototype.updateContext=function(){this.registerComponentsInContext()},e}(),LifecycleValidator=function(){function e(){}return e.lifecycleExistsInConfiguration=function(e){return!util_12(e)&&!util_12(e.lifecycle)&&util_14(e.lifecycle)},e.validateMethod=function(e){return!util_12(e)&&util_17(e)},e.getLifecycleMethodsDesriptor=function(t,n){var o={};return Object.keys(n.lifecycle).forEach(function(r){var i=t[n.lifecycle[r]];o[r]=e.validateMethod(i)?i:null}),o},e.validateLifecycle=function(t,n,o){var r=new ComponentLifecycle(o.id);if(e.lifecycleExistsInConfiguration(o)){var i=e.getLifecycleMethodsDesriptor(n,o);r.setLifecycleMethods(i)}t.getContextLifecycle().getComponentLifecycles().set(o.id,r)},e}(),PropertyValidator=function(){function e(){}return e.validateName=function(e){return null!=e.name&&util_10(e.name)},e.validateValue=function(e){return null!=e.value},e.validateReference=function(e){return null!=e.reference&&util_14(e.reference)},e.validateProperties=function(t){return t.forEach(function(t){if(t.value){if(t.value&&(!e.validateName(t)||!e.validateValue(t)))return!1}else if(!e.validateName(t)||!e.validateReference(t))return!1}),!0},e}(),MetadataValidationError=function(e){function t(t){var n=this,o='Metadata validation was failed in file "'+t+'".';return n=e.call(this,o)||this,n.name="MetadataValidationError",n}return __extends(t,e),t}(Error),jsonfile$1=require("jsonfile"),path=require("path"),fs=require("fs"),PROPERTY_LENGTH=2,MetadataValidator=function(){function e(){}return e.validateConfigurationFiles=function(e){var t=[];return e.forEach(function(e){try{fs.statSync(e),LOGGER.debug('[Metadata Validation]: Configuration file by path "'+e+'" was found'),t.push({path:e,content:jsonfile$1.readFileSync(e)})}catch(t){LOGGER.error('[Metadata Validation]: Cannot read the file by the following path: "'+e+'".')}}),t},e.validateConfigurationObjects=function(e){var t=[];return e.forEach(function(e){var n=e.content.configuration;if(!n)throw LOGGER.error('[Metadata Validation]: Configuration object from metadata in file "'+e.path+'" does not exist'),new MetadataValidationError(e.path);t.push({filePath:e.path,configuration:n})}),t},e.validateComponentsArray=function(t){t.forEach(function(t){var n=t.configuration.components;if(!n)throw LOGGER.error("[Metadata Validation]: Components' array from metadata in file \""+t.filePath+'" does not exist'),new MetadataValidationError(t.filePath);var o={filePath:t.filePath,components:n};e.validateConfigComponent(o)})},e.validateConfigComponent=function(t){t.components.forEach(function(n,o){if(!util_14(n))throw LOGGER.error("[Metadata Validation]: Component["+o+'] from metadata in file "'+t.filePath+'" is not an object'),new MetadataValidationError(t.filePath);var r={index:o,instance:n,filePath:t.filePath};e.validateConfigLifecycle(r),e.validateConfigScope(r),e.validateConfigProperties(r)})},e.configLifecycleHasMethod=function(e,t){return e.hasOwnProperty(t)&&util_10(e[t])},e.validateConfigLifecycle=function(t){var n=t.instance.lifecycle;if(n){if(!util_14(n))throw LOGGER.error("[Metadata Validation]: Component["+t.index+'] from metadata in file "'+t.filePath+'" has invalid lifecycle object'),new MetadataValidationError(t.filePath);Object.keys(n).forEach(function(o){if(!e.configLifecycleHasMethod(n,o))throw LOGGER.error("[Metadata Validation]: Component["+t.index+'] from metadata in file "'+t.filePath+'" has invalid lifecycle object'),new MetadataValidationError(t.filePath)}),LOGGER.debug("[Metadata Validation]: Lifecycle of the Component["+t.index+'] from metadata in file "'+t.filePath+'" is successfully validated')}else LOGGER.warn("[Metadata Validation]: Component["+t.index+'] from metadata in file "'+t.filePath+'" has no lifecycle object')},e.configPropertyHasName=function(e){return e.hasOwnProperty("name")&&util_10(e.name)},e.configPropertyHasValue=function(e){return e.hasOwnProperty("value")&&!util_8(e.value)},e.configPropertyHasReference=function(e){return e.hasOwnProperty("reference")&&util_10(e.reference)},e.validateConfigProperties=function(t){var n=t.instance.properties;if(!util_5(n))throw LOGGER.error("[Metadata Validation]: Component["+t.index+'] from metadata in file "'+t.filePath+"\"has invalid properties' instance"),new MetadataValidationError(t.filePath);n.forEach(function(n){if(Object.keys(n).length===PROPERTY_LENGTH&&e.configPropertyHasName(n)){if(!e.configPropertyHasValue(n)&&!e.configPropertyHasReference(n))throw LOGGER.error("[Metadata Validation]: Component["+t.index+'] from metadata in file "'+t.filePath+' has invalid property "'+n.name+'"'),new MetadataValidationError(t.filePath);LOGGER.debug('[Metadata Validation]: Property "'+n.name+'" of the Component['+t.index+'] from metadata in file "'+t.filePath+" is successfully validated")}})},e.validateConfigScope=function(e){var t=e.instance.scope;if(t){if(!util_10(t)||!["singleton","prototype"].includes(t))throw LOGGER.error("[Metadata Validation]: Component["+e.index+'] from metadata in file "'+e.filePath+'" has invalid scope'),new MetadataValidationError(e.filePath);LOGGER.debug("[Metadata Validation]: Scope of the Component["+e.index+'] from metadata in file "'+e.filePath+" is successfully validated")}else LOGGER.debug("[Metadata Validation]: Scope of the Component["+e.index+'] from metadata in file "'+e.filePath+'" will be set to SINGLETON as default')},e.validateMetadata=function(t){LOGGER.info("[Metadata Validation]: Metadata validation process is starting...");var n=e.validateConfigurationFiles(t),o=e.validateConfigurationObjects(n);e.validateComponentsArray(o),LOGGER.info("[Metadata Validation]: Metadata validation process was finished...")},e}(),PropertyValidationError=function(e){function t(t){var n=this,o='Component with id "'+t+'" contains wrong property.';return n=e.call(this,o)||this,n.name="PropertyValidationError",n}return __extends(t,e),t}(Error),jsonfile=require("jsonfile"),APPLICATION_ROOT_DIRECTORY=require("app-root-dir").get(),MetadataContext=function(e){function t(t){var n=e.call(this)||this;return t&&(MetadataValidator.validateMetadata(t),n.configs=t,n.registerComponentsInContext(),LOGGER.info("[MetadataContext]: Context was initialized")),n}return __extends(t,e),t.prototype.parseMetadataFromConfigurationFile=function(){var e=[];return this.configs.forEach(function(t){var n=jsonfile.readFileSync(t).configuration;e.push({configName:t,config:n})}),e},t.prototype.getPropertiesFromConfiguration=function(e,t){var n=e.properties,o=[];return n&&n.forEach(function(e){var n=Object.getOwnPropertyNames(t.default.prototype).find(function(t){return t===e.name});e.value&&n?o.push({name:e.name,value:e.value}):e.reference&&n&&o.push({name:e.name,reference:e.reference})}),o},t.prototype.defineComponentScope=function(e){return"singleton"===e.scope?0:"prototype"===e.scope?1:0},t.prototype.setBasicPropertiesToComponents=function(e){var t=this;e.forEach(function(e){var n=APPLICATION_ROOT_DIRECTORY+"/"+e.classPath,o=require(n),r=o.default.prototype,i=Object.create(r);LifecycleValidator.validateLifecycle(t,r,e);var a=t.getContextLifecycle().getComponentLifecycles().get(e.id);a.callPreInitMethod();var c=new Component(e.id,e.name,e.classPath,t.defineComponentScope(e)),s=t.getPropertiesFromConfiguration(e,o);if(!PropertyValidator.validateProperties(s))throw new PropertyValidationError(e.id);s.forEach(function(e){e.value?i[e.name]=e.value:i[e.name]=null}),a.callBeforePropertiesWillBeSetMethod(),c.setEntityInstance(i),t.components.set(e.id,c),a.callPostInitMethod()})},t.prototype.setReferencesToComponents=function(e){var t=this;this.components.forEach(function(n){var o=t.getContextLifecycle().getComponentLifecycles().get(n.getId()),r=require(APPLICATION_ROOT_DIRECTORY+"/"+n.getClassPath());e.forEach(function(e){t.getPropertiesFromConfiguration(e,r).forEach(function(e){if(e.reference){var o=t.getComponentEntityInstanceById(e.reference);n.getEntityInstance()[e.name]=o}})}),o.callAfterPropertiesWereSetMethod()})},t.prototype.getUniqueConfigComponents=function(){var e=[];return this.parseMetadataFromConfigurationFile().forEach(function(t){t.config.components.forEach(function(t){e.find(function(e){return e.id===t.id})||e.push(t)})}),e},t.prototype.getConfigComponents=function(){return this.getUniqueConfigComponents()},t.prototype.registerComponentsInContext=function(){var e=this.getConfigComponents();this.setBasicPropertiesToComponents(e),this.setReferencesToComponents(e)},t}(Context),_$2=require("lodash"),DecoratorContext$$1=function(e){function t(t){var n=e.call(this)||this;return t&&t.length>0&&(n.configs=t,n.registerComponentsInContext(),LOGGER.info("[DecoratorContext]: Context was initialized")),n}return __extends(t,e),t.prototype.registerComponentsInContext=function(){var e=this;this.configs.forEach(function(t){var n=t.prototype;Object.keys(n).map(function(e){return n[e]}).forEach(function(t){if(t){var n=t.call(e).component,o=t.call(e).lifecycle;e.contextLifecycle.getComponentLifecycles().set(n.getId(),o),o.callPreInitMethod(),e.components.set(n.id,n),o.callPostInitMethod()}})})},t.prototype.getComponentEntityInstanceByClass=function(e){for(var t=Array.from(this.components.values()),n=0;n<t.length;n++){var o=t[n].getEntityInstance();if(o instanceof e)return 1===t[n].getScope()?_$2.cloneDeep(o):o;if(n===t.length-1)throw new ComponentNotFoundError("undefined")}},t}(Context),generateComponentId=function(){return Math.random().toString(36).substring(2,7)},getComponentLifecycle=function(e,t){var n=new ComponentLifecycle(t);return Object.keys(e).forEach(function(t){var o=e[t];o instanceof Object&&(o.hasOwnProperty("preInitMethod")?n.setPreInitMethod(o.preInitMethod):e[t].postInitMethod?n.setPostInitMethod(o.postInitMethod):e[t].preDestroyMethod?n.setPreDestroyMethod(o.preDestroyMethod):e[t].postDestroyMethod&&n.setPostDestroyMethod(o.postDestroyMethod))}),n};exports.MetadataContext=MetadataContext,exports.DecoratorContext=DecoratorContext$$1,exports.component=component,exports.preInit=preInit,exports.postInit=postInit,exports.preDestroy=preDestroy,exports.postDestroy=postDestroy;
